// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id                String   @id @default(cuid())
  email             String   @unique
  name              String?
  password          String?
  role              Role     @default(USER)
  subscriptionPlan  Plan     @default(FREE)
  streak            Int      @default(0)
  totalPoints       Int      @default(0)
  avatar            String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  quizResults       QuizResult[]
  leaderboardEntries Leaderboard[]
  aiSuggestions     AISuggestion[]
  subscriptions      Subscription[]

  @@map("users")
}

model Quiz {
  id            String   @id @default(cuid())
  category      Category
  question      String
  options       String   // JSON string of options array
  correctAnswer Int      // Index of correct answer in options array
  explanation   String?
  difficulty    Difficulty @default(MEDIUM)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  quizResults   QuizResult[]

  @@map("quizzes")
}

model QuizResult {
  id            String   @id @default(cuid())
  userId        String
  quizId        String
  score         Int
  totalQuestions Int
  accuracy      Float
  timeSpent     Int      // in seconds
  answers       String   // JSON string of user answers array
  category      Category
  createdAt     DateTime @default(now())

  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  quiz          Quiz     @relation(fields: [quizId], references: [id], onDelete: Cascade)

  @@map("quiz_results")
}

model Blog {
  id          String   @id @default(cuid())
  title       String
  thumbnail   String?
  content     String
  tags        String   // JSON string of tags array
  views       Int      @default(0)
  author      String
  published   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("blogs")
}

model Leaderboard {
  id        String   @id @default(cuid())
  userId    String
  score     Int
  rank      Int
  date      DateTime @default(now())
  type      LeaderboardType @default(DAILY)

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("leaderboard")
}

model AISuggestion {
  id          String   @id @default(cuid())
  userId      String
  title       String
  content     String
  type        SuggestionType
  isRead      Boolean  @default(false)
  createdAt   DateTime @default(now())

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("ai_suggestions")
}

model Subscription {
  id                String   @id @default(cuid())
  userId            String
  plan              Plan
  startDate         DateTime
  endDate           DateTime?
  status            SubscriptionStatus @default(ACTIVE)
  paymentMethod     String?
  amount            Float
  transactionId     String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("subscriptions")
}

model StudyMaterial {
  id          String   @id @default(cuid())
  title       String
  content     String
  category    Category
  type        MaterialType
  isPremium   Boolean  @default(false)
  views       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("study_materials")
}

model MockTest {
  id          String   @id @default(cuid())
  title       String
  category    Category
  questions   String   // JSON string of quiz IDs array
  duration    Int      // in minutes
  totalMarks  Int
  isPremium   Boolean  @default(false)
  createdAt   DateTime @default(now())

  @@map("mock_tests")
}

enum Role {
  USER
  ADMIN
}

enum Plan {
  FREE
  PREMIUM
  ALL_IN_ONE
}

enum Category {
  SSC
  HSC
  ADMISSION
  JOB
}

enum Difficulty {
  EASY
  MEDIUM
  HARD
}

enum LeaderboardType {
  DAILY
  WEEKLY
  MONTHLY
  ALL_TIME
}

enum SuggestionType {
  WEAK_TOPIC
  STUDY_PLAN
  PERFORMANCE
  MOTIVATION
}

enum SubscriptionStatus {
  ACTIVE
  EXPIRED
  CANCELLED
}

enum MaterialType {
  NOTE
  VIDEO
  PDF
  ARTICLE
}